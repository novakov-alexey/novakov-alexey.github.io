<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <meta content="#ffffff" name="theme-color" />
  <meta content="#da532c" name="msapplication-TileColor" />

  
  
  
  
  

  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.css"
    rel="stylesheet" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />
  <link href='https://novakov-alexey.github.io/site.css' rel="stylesheet" />

  
  

  <title>
    
Alexey Novakov Notes | Artificial Neural Network in Scala - part 1

  </title>

  <script crossorigin="anonymous" src="https://kit.fontawesome.com/201b8d5e05.js"></script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-49N5BCWL0F"></script>
  <script type="text/javascript">
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "G-49N5BCWL0F");
  </script>
  
</head>

<body class="has-background-white">
  
  <nav aria-label="section navigation" class="navbar is-light" role="navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item has-text-weight-bold" href="https:&#x2F;&#x2F;novakov-alexey.github.io">Alexey Novakov Notes</a>
        <a aria-expanded="false" aria-label="menu" class="navbar-burger burger" data-target="navMenu" role="button">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
      <div class="navbar-menu" id="navMenu">
        <div class="navbar-end has-text-centered">
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;'>
            Blog
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;cv'>
            CV
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;presentations'>
            Presentations
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;tags'>
            Tags
          </a>
          
          <a class="navbar-item" href='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;categories'>
            Categories
          </a>
          
          <a class="navbar-item" id="nav-search" title="Search" data-target="#search-modal">
            <span class="icon">
              <i class="fas fa-search"></i>
            </span>
          </a>
          <a class="navbar-item" id="dark-mode" title="Switch to dark theme">
            <span class="icon">
              <i class="fas fa-adjust"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  

  
  

  
<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <article class="box">
          <h1 class="title is-1">
            Artificial Neural Network in Scala - part 1
          </h1>
          <p class="subtitle"></p>
          <div class="columns is-multiline is-gapless">
            <div class="column is-8">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="fas fa-user"></i>
    </span>
    Alexey Novakov published on
    <span class="icon">
      <i class="far fa-calendar-alt"></i>
    </span>
    <time datetime='2021-02-04'>February 04, 2021</time>
  </p>

            </div>
            <div class="column is-4 has-text-right-desktop">
              
  <p class="has-text-grey">
    <span class="icon">
      <i class="far fa-clock"></i>
    </span>
    12 min,
    <span class="icon">
      <i class="fas fa-pencil-alt"></i>
    </span>
    2317 words
  </p>

            </div>
            <div class="column">
              
              
  <p>
    <span class="has-text-black has-text-weight-normal">Categories:</span>
    
      <a class="link has-text-weight-light" href='https://novakov-alexey.github.io/categories/math/'>
        <span class="icon is-small">
          <i class="fas fa-folder fa-xs"></i>
        </span>
        math
      </a>
    
  </p>

              
            </div>
            <div class="column has-text-right-desktop">
              
              
  <p>
    <span class="has-text-black has-text-weight-normal">Tags:</span>
    
      <a class="link has-text-weight-light" href='https://novakov-alexey.github.io/tags/deep-learning/'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        deep learning
      </a>
    
      <a class="link has-text-weight-light" href='https://novakov-alexey.github.io/tags/machine-learning/'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        machine learning
      </a>
    
      <a class="link has-text-weight-light" href='https://novakov-alexey.github.io/tags/gradient-descent/'>
        <span class="icon is-small">
          <i class="fas fa-tag fa-xs"></i>
        </span>
        gradient descent
      </a>
    
  </p>

              
            </div>
          </div>
          <div class="content mt-2 has-text-justified">
            

<img src="https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;processed_images&#x2F;deep-learning.9c5efaf8c3e5efee.png" class="center-image"/>
<br/><br/>
<p><em>Deep Learning</em> is a group of machine learning methods which are based on artificial neural networks. Some of the deep learning architectures are deep neural networks.
Deep neural network is an artificial neural network (ANN further) with multiple layers between the input and output layers. There are different types of neural networks, but they always have
neurons, synapses, weights, biases and functions.</p>
<span id="continue-reading"></span>

<img src="https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;processed_images&#x2F;Scala_logo.8955961f705bf49a.png" class="center-image"/>
<br/><br/>
<p><a href="https://www.scala-lang.org/">Scala</a> is a full-stack multi-paradigm programming language. Scala is famous for its innovations in JVM eco-system and
ambitious language syntax features leaving all other JVM-based languages for years behind.
Scala is also popular language thanks to Apache Spark, Kafka and Flink projects which are mainly implemented in it.</p>
<h1 id="scope">Scope</h1>
<p>This tutorial is divided into 2 articles.</p>
<ol>
<li>
<p>In this article we will go through the theory of ANN implementation. I will guide you through the basic calculus such as linear algebra and a little bit of differential calculus, which you need to know to implement neural network training and optimization algorithms.</p>
</li>
<li>
<p>In <a href="../ann-in-scala-2">the second aritcle</a> we are going to implement ANN from scratch in Scala.
You can jump into second part directly, if you are familiar with the theory. But first look at the ANN Jargon table, if you decided to switch to second part.</p>
</li>
</ol>
<h1 id="ann-jargon">ANN Jargon</h1>
<p>I assume you are a bit familiar with Machine Learning or Deep Learning. Nevertheless, below table will be useful to match
Deep Learning terminology with further Scala implementation. Some of the variable names in Scala code will be directly based
on the Deep learning name definitions, so that it is important to know why some variable is named as <code>z</code> and another one as <code>w</code>.</p>
<table><thead><tr><th>Code Symbol / Type</th><th style="text-align: center">Description</th><th style="text-align: center">Encoded as</th></tr></thead><tbody>
<tr><td>x</td><td style="text-align: center">input data for each neuron</td><td style="text-align: center">2-dimensional tensor, i.e. matrix</td></tr>
<tr><td>y , actual</td><td style="text-align: center">target data we know in advance from the training dataset</td><td style="text-align: center">1-d tensor, i.e. vector</td></tr>
<tr><td>yHat , predicted</td><td style="text-align: center">output of the neural network during the training or single prediction</td><td style="text-align: center">1-d tensor</td></tr>
<tr><td>w</td><td style="text-align: center">layer weight, a.k.a model parameters</td><td style="text-align: center">2-d tensor</td></tr>
<tr><td>b</td><td style="text-align: center">layer bias, part of the layer parameters</td><td style="text-align: center">1-d tensor</td></tr>
<tr><td>z</td><td style="text-align: center">layer activation, calculated as <br/> <code>x * w + b</code></td><td style="text-align: center">2-d tensor</td></tr>
<tr><td>f</td><td style="text-align: center">activation function to activate neuron. Specific implementation: sigmoid, relu</td><td style="text-align: center">Scala function</td></tr>
<tr><td>a</td><td style="text-align: center">layer activity, calculated as f(z)</td><td style="text-align: center">2-d tensor</td></tr>
<tr><td>error</td><td style="text-align: center">it is result of yHat - y</td><td style="text-align: center">1-d tensor</td></tr>
<tr><td>lossFunc</td><td style="text-align: center">loss function to calculate error rate on training/validation (example: mean squared error)</td><td style="text-align: center">Scala function</td></tr>
<tr><td>epochs</td><td style="text-align: center">number of iterations to train ANN</td><td style="text-align: center"><code>integer</code> &gt; 0</td></tr>
<tr><td>accuracy</td><td style="text-align: center">% of correct predictions on train or test data sets</td><td style="text-align: center"><code>double</code> number, between 0 and 1</td></tr>
<tr><td>learningRate</td><td style="text-align: center">numeric parameter used in weights update</td><td style="text-align: center"><code>double</code> number, usually between 0.01 and 0.1</td></tr>
</tbody></table>
<h1 id="tensor">Tensor</h1>
<p>Deep Learning is all about tensor calculus. Tensor in computer science is a generic abstraction for N-dimensional array.
In our ANN implementation, we are going to use scalar numbers which are encoded as 0-dimension tensor, vector - encoded as 1-d tensor and
finally matrix - encoded as 2-d tensor. Vector and matrix are the most used building blocks for Deep Learning calculus. All tensor shapes we will
use are going to be rectangular - every element is the same size along each axis.</p>
<h1 id="dataset">Dataset</h1>
<p>We will take _Churn Modelling dataset which predicts whether a customer is going to leave the bank or not.
This dataset is traveling across many tutorials at the Internet,
so that you can find a couple different code implementations among dozens of articles using the same data, so do I.</p>
<pre data-lang="csv" style="background-color:#2e3440;color:#d8dee9;" class="language-csv "><code class="language-csv" data-lang="csv"><span style="color:#81a1c1;">RowNumber,CustomerId,Surname,CreditScore,Geography,Gender,Age,Tenure,Balance,NumOfProducts,HasCrCard,IsActiveMember,EstimatedSalary,Exited
</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">15634602</span><span style="color:#81a1c1;">,Hargrave,</span><span style="color:#b48ead;">619</span><span style="color:#81a1c1;">,France,Female,</span><span style="color:#b48ead;">42</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">2</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">101348.88</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1
</span><span style="color:#b48ead;">2</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">15647311</span><span style="color:#81a1c1;">,Hill,</span><span style="color:#b48ead;">608</span><span style="color:#81a1c1;">,Spain,Female,</span><span style="color:#b48ead;">41</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">83807.86</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">112542.58</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0
</span><span style="color:#b48ead;">3</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">15619304</span><span style="color:#81a1c1;">,Onio,</span><span style="color:#b48ead;">502</span><span style="color:#81a1c1;">,France,Female,</span><span style="color:#b48ead;">42</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">8</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">159660.8</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">3</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">113931.57</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1
</span><span style="color:#b48ead;">4</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">15701354</span><span style="color:#81a1c1;">,Boni,</span><span style="color:#b48ead;">699</span><span style="color:#81a1c1;">,France,Female,</span><span style="color:#b48ead;">39</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">1</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">2</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">93826.63</span><span style="color:#81a1c1;">,</span><span style="color:#b48ead;">0
</span></code></pre>
<p>The last column is <code>y</code>, i.e. the value we want our ANN to predict between 0 and 1. Rest of the columns are <code>x</code> data, also known as features. We drop
first 3 columns and the last column <code>y</code> before we use them as <code>x</code> matrix. Remaining columns:</p>
<pre data-lang="csv" style="background-color:#2e3440;color:#d8dee9;" class="language-csv "><code class="language-csv" data-lang="csv"><span style="color:#81a1c1;">CreditScore,
</span><span style="color:#81a1c1;">Geography,
</span><span style="color:#81a1c1;">Gender,
</span><span style="color:#81a1c1;">Age,
</span><span style="color:#81a1c1;">Tenure,
</span><span style="color:#81a1c1;">Balance,
</span><span style="color:#81a1c1;">NumOfProducts,
</span><span style="color:#81a1c1;">HasCrCard,
</span><span style="color:#81a1c1;">IsActiveMember,
</span><span style="color:#81a1c1;">EstimatedSalary
</span></code></pre>
<h1 id="network-topology">Network Topology</h1>


<img src="https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;processed_images&#x2F;ann.d6587d61060392a7.png" class="center-image"/>
<br/><br/>
<p>Above picture describes a network we are going to implement.</p>
<ul>
<li>
<p><em>N</em> is a number of features, i.e. remaining columns from the input dataset.</p>
</li>
<li>
<p>Each layer is fully connected with next layer. I draw each layer by skipping middle neurons to get smaller visual overhead.</p>
</li>
<li>
<p>Between each layer we have weights which form linear equations via dot product <code>x</code> * <code>w</code> + <code>bias</code>.</p>
</li>
<li>
<p>Each layer has its own activation functions. We use ReLU (Rectified Linear Unit) and Sigmoid functions.</p>
</li>
</ul>
<h1 id="forward-propagation">Forward Propagation</h1>
<p>Basic idea of neural network implementation is to leverage math principals for matrix and vector multiplication. As neural network is going to be fully connected from layer to layer, we can represent learning and optimization algorithms as following:</p>
<h2 id="dimensions">Dimensions</h2>
<h3 id="single-training-example">Single training example</h3>
<p>It is one data record:</p>
<ol>
<li>x: 12 input columns as 1 x 12 matrix</li>
<li>w1: 12 x 6 matrix + 6 x 1 matrix for biases</li>
<li>w2: 6 x 6 matrix + 6 x 1 matrix for biases</li>
<li>w3: 6 x 1 matrix + 1 x 1 matrix for biases</li>
<li>yHat: scalar number</li>
</ol>
<p>An amount of hidden layers and neurons are parameters to be tuned by an expert, i.e. externally to the main algorithm.
We set 2 hidden layers with 6 neurons each. Our last layer
is single neuron that produces final prediction, which we will treat as <code>yes</code> or <code>no</code> to answer customer churn question.</p>
<h3 id="multiple-training-examples">Multiple training examples</h3>
<p>Mini-batch approach, i.e. multiple training examples at once. Batch size to be tuned externally as well. Let's take 16 as batch size:</p>
<ol>
<li>x: 16 x 12 matrix</li>
<li>w1: 12 x 6 matrix + 6 x 1 matrix for biases</li>
<li>w2: 6 x 6 matrix + 6 x 1 matrix for biases</li>
<li>w3: 6 x 1 matrix + 1 x 1 matrix for biases</li>
<li>yHat: 16 x 1 matrix</li>
</ol>
<p>As you can see, our matrices are equal in rows at input and output layers.
That means we can input any number of rows through the neural network at once when we do training or prediction.</p>
<h2 id="math-of-the-forward-propagation">Math of the Forward propagation</h2>
<p>When we train neural network, we use input data and parameters on all hidden layers to reach output layer, so that we get the prediction value(s).
First part of the ANN implementation that calculates predictions, i.e. <code>yHat</code> is called _forward propagation.</p>
<p>Linear algebra helps us to feed data into the network and get the result using matrix multiplication principals. That makes the entire training and single
prediction quite generic, so that we can easily program that in any programming language.</p>
<p>In a nutshell, our 12 x 6 x 6 x 1 network will form the following expressions for every training batch:</p>
<h3 id="first-hidden-layer">First Hidden Layer</h3>


<img src="https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;processed_images&#x2F;ann-forward.1694dec18930be19.png" class="center-image"/>
<br/><br/>
<p>Above picture shows activations for the neurons of the first hidden layer. In fact, next layers are calculated in similar way.</p>
<ul>
<li>
<p><em>X</em> is a matrix where each row is a data sample. Every column is a particular feature/column from the initial dataset. Usually, input column is scaled/encoded (see second article).</p>
</li>
<li>
<p>We use dot product operation for <em>X</em> and <em>W</em>.
Resulting matrix is used to add biases using element-wise addition. b1 will be added to each element of the first row of that resulting matrix,
then b2 to the second row and so on.</p>
</li>
</ul>
<h3 id="second-hidden-layer">Second Hidden Layer</h3>
<p>The <code>x</code> of the second layer is an <code>a</code> we calculated on the previous layer. We will call it <code>a1</code>.</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">a1</span><span> (16 x 6) </span><span style="color:#88c0d0;">*</span><span> w2 (6 x 6) </span><span style="color:#88c0d0;">+</span><span> b2 (6 x 1) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">z2</span><span> (16 x 6)
</span><span>
</span><span style="color:#88c0d0;">f</span><span>(z2) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">a2</span><span> (16 x 6)
</span></code></pre>
<p>Above pseudo-code shows matrix dimensions in the parenthesis.</p>
<h3 id="output-layer">Output Layer</h3>
<p>Input data is a2. Here we get out prediction at the end:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">a2</span><span> (16 x 6) </span><span style="color:#88c0d0;">*</span><span> w3 (6 x 1) </span><span style="color:#88c0d0;">+</span><span> b3 (1 x 1) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">z3</span><span> (16 x 1)
</span><span>
</span><span style="color:#88c0d0;">f</span><span>(z3) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">a3</span><span> (16 x 1)
</span></code></pre>
<p><code>a3</code> a.k.a yHat represents a prediction for each data sample in the batch. Prediction values are probabilities between 0 and 1.</p>
<p>If you are confused with above explanation, I recommend to check great video series on Deep Learning: <a href="https://www.youtube.com/watch?v=aircAruvnKk">But what is a Neural Network? | Deep learning, chapter 1</a>.</p>
<h2 id="batch-tracing">Batch Tracing</h2>
<p>In order to see what is going on with the state of neural network, let's feed one single batch into it.</p>
<p>There are different strategies for initial weights and biases initialisation. In our implementation we will follow:</p>
<ul>
<li>weight matrices are initialised using uniform-random</li>
<li>bias vectors are initialised with zeros</li>
</ul>
<p>Later they will be updated via optimization algorithm.</p>
<h3 id="x-input">x - input</h3>
<p>Below matrix is our <code>x</code>, which is our input data from the training or test set. The values it contains is a result of
data preparation step, which I will explain in details further:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 16x12, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[-0.032920357,1.1368092,-0.579135,-0.6694619,-0.9335201,0.3765018,-1.0295835,-1.0824665,-0.9476086,0.7312724,0.8284169,-0.05904571]
</span><span> </span><span style="color:#88c0d0;">[-0.12171035,-0.86240697,-0.579135,1.464448,-0.9335201,0.26486462,-1.3750359,0.2695743,-0.9476086,-1.340666,0.8284169,0.1443363]
</span><span> </span><span style="color:#88c0d0;">[-0.97732306,1.1368092,-0.579135,-0.6694619,-0.9335201,0.3765018,1.0431306,1.4932814,2.0728939,0.7312724,-1.1834527,0.16957337]
</span><span> </span><span style="color:#88c0d0;">[0.6128251,1.1368092,-0.579135,-0.6694619,-0.9335201,0.041590314,-1.3750359,-1.0824665,0.5626426,-1.340666,-1.1834527,-0.19572]
</span><span> </span><span style="color:#88c0d0;">[1.8316696,-0.86240697,-0.579135,1.464448,-0.9335201,0.48813897,-1.0295835,0.94235253,-0.9476086,0.7312724,0.8284169,-0.463582]
</span><span> </span><span style="color:#88c0d0;">[0.17694691,-0.86240697,-0.579135,1.464448,1.0502101,0.59977615,1.0431306,0.7527129,0.5626426,0.7312724,-1.1834527,0.82049227]
</span><span> </span><span style="color:#88c0d0;">[1.6056587,1.1368092,-0.579135,-0.6694619,1.0502101,1.2695991,0.69767827,-1.0824665,0.5626426,0.7312724,0.8284169,-1.7176533]
</span><span> </span><span style="color:#88c0d0;">[-1.9943721,-0.86240697,1.6928561,-0.6694619,-0.9335201,-1.0747813,-0.33867878,0.7735395,3.583145,0.7312724,-1.1834527,0.267966]
</span><span> </span><span style="color:#88c0d0;">[-0.9853949,1.1368092,-0.579135,-0.6694619,1.0502101,0.59977615,-0.33867878,1.20919,0.5626426,-1.340666,0.8284169,-0.5388685]
</span><span> </span><span style="color:#88c0d0;">[0.49174783,1.1368092,-0.579135,-0.6694619,1.0502101,-1.2980556,-1.0295835,1.0890474,-0.9476086,0.7312724,0.8284169,-0.5972788]
</span><span> </span><span style="color:#88c0d0;">[-0.7674558,1.1368092,-0.579135,-0.6694619,1.0502101,-0.85150695,0.35222593,0.563331,0.5626426,-1.340666,-1.1834527,-0.44364995]
</span><span> </span><span style="color:#88c0d0;">[-1.0176822,-0.86240697,-0.579135,1.464448,1.0502101,-1.6329671,-0.68413115,-1.0824665,0.5626426,0.7312724,-1.1834527,-0.5125319]
</span><span> </span><span style="color:#88c0d0;">[-1.1871903,1.1368092,-0.579135,-0.6694619,-0.9335201,-0.5165955,1.7340354,-1.0824665,0.5626426,0.7312724,-1.1834527,-1.4233431]
</span><span> </span><span style="color:#88c0d0;">[-0.5979476,1.1368092,-0.579135,-0.6694619,-0.9335201,-1.52133,0.0067735757,-1.0824665,0.5626426,-1.340666,-1.1834527,1.5672718]
</span><span> </span><span style="color:#88c0d0;">[0.09622873,-0.86240697,-0.579135,1.464448,-0.9335201,-0.40495834,0.69767827,-1.0824665,0.5626426,0.7312724,0.8284169,-0.70219]
</span><span> </span><span style="color:#88c0d0;">[-0.05713581,-0.86240697,1.6928561,-0.6694619,1.0502101,0.71141326,-0.68413115,1.2265866,0.5626426,-1.340666,0.8284169,-0.731704]]
</span></code></pre>
<h3 id="w1-between-input-and-1st-hidden-layers">w1 - between input and 1st hidden layers</h3>
<p>weight:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 12x6, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[0.0031250487,0.6230519,0.41888618,0.89568454,0.6927525,0.7887961]
</span><span> </span><span style="color:#88c0d0;">[0.30450296,0.75655645,0.075620584,0.898596,0.66731954,0.06079619]
</span><span> </span><span style="color:#88c0d0;">[0.21693613,0.89243406,0.6251479,0.080811165,0.30963784,0.87972105]
</span><span> </span><span style="color:#88c0d0;">[0.006676915,0.05886997,0.88085854,0.29817313,0.19820364,0.6823392]
</span><span> </span><span style="color:#88c0d0;">[0.73550576,0.49408147,0.99867696,0.71354216,0.9676805,0.09009225]
</span><span> </span><span style="color:#88c0d0;">[0.19121544,0.021707054,0.53959745,0.74587476,0.16132912,0.08185377]
</span><span> </span><span style="color:#88c0d0;">[0.2528674,0.562563,0.17039675,0.7291027,0.41844574,0.4336123]
</span><span> </span><span style="color:#88c0d0;">[0.8275197,0.5867702,0.1692482,0.102723576,0.8936942,0.12275006]
</span><span> </span><span style="color:#88c0d0;">[0.15337862,0.55374163,0.7993138,0.73106086,0.29611018,0.6279454]
</span><span> </span><span style="color:#88c0d0;">[0.15933406,0.5840742,0.42520604,0.44090283,0.13000321,0.25581995]
</span><span> </span><span style="color:#88c0d0;">[0.8168607,0.25407365,0.6668799,0.277898,0.13848923,0.94559854]
</span><span> </span><span style="color:#88c0d0;">[0.61593276,0.8569094,0.83978665,0.12022303,0.097834654,0.9559516]]
</span></code></pre>
<p>bias:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6, Tensor1D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[0.0,0.0,0.0,0.0,0.0,0.0]
</span></code></pre>
<h3 id="w2-between-1st-and-2nd-hidden-layers">w2 - between 1st and 2nd hidden layers</h3>
<p>weight:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6x6, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[0.77492374,0.20006068,0.8301353,0.8226056,0.726444,0.54590976]
</span><span> </span><span style="color:#88c0d0;">[0.8728169,0.83197665,0.5453676,0.7730933,0.77980715,0.20573096]
</span><span> </span><span style="color:#88c0d0;">[0.8222075,0.94630164,0.29234344,0.7667057,0.3600455,0.26467463]
</span><span> </span><span style="color:#88c0d0;">[0.5196553,0.3935514,0.23351222,0.18136671,0.01824836,0.25099826]
</span><span> </span><span style="color:#88c0d0;">[0.8864608,0.64109814,0.3031471,0.18872173,0.5463185,0.26470202]
</span><span> </span><span style="color:#88c0d0;">[0.102771536,0.92541504,0.21454614,0.8614344,0.10369446,0.76455885]]
</span></code></pre>
<p>bias:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6, Tensor1D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[0.0,0.0,0.0,0.0,0.0,0.0]
</span></code></pre>
<h3 id="w3-between-2nd-hidden-and-output-layers">w3 - between 2nd hidden and output layers</h3>
<p>weight:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6x1, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[0.63033116]
</span><span> </span><span style="color:#88c0d0;">[0.6078242]
</span><span> </span><span style="color:#88c0d0;">[0.022346135]
</span><span> </span><span style="color:#88c0d0;">[0.62451136]
</span><span> </span><span style="color:#88c0d0;">[0.89858407]
</span><span> </span><span style="color:#88c0d0;">[0.5960952]]
</span></code></pre>
<p>bias:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 1, Tensor1D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[0.0]
</span></code></pre>
<h3 id="yhat-output-layer">yHat - Output layer</h3>
<p>Predictions for the input batch:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 16, Tensor1D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[0.8810671,0.49800232,0.86774874,0.49800232,0.99999976,0.83703655,0.49800232,0.49800232,0.9976035,0.49800232,0.9999994,0.49800232,0.8031284,0.49800232,0.9775441,0.86094683]
</span></code></pre>
<hr />
<p>Above trace is for the first training batch at the very first epoch. You should not try understand these digits in weights, biases and outputs matrices.
They are going to change their values a lot after running training loop 100 times (epochs) with N batches each.</p>
<h1 id="backward-propagation">Backward Propagation</h1>
<p>Initial weights and biases are not going to give us right equations to predict our <em>y</em>. Even if we propagate the entire dataset through the network.
Obviously, someone needs to update these parameters based on some feedback. This feedback is calculated via <code>loss</code> function.
In the science literature, <code>loss function</code> is also called as <code>cost function</code>. We are going to use <code>loss</code> and <code>cost</code> here as synonymous.</p>
<p>There are different loss functions in Deep Learning we can use. We will go with <code>binary-cross-entropy</code> as we predict binary value.
Our loss value will show how good we are updating the network weights at specific training epoch. However, updates will be done using Gradient
Descent optimization algorithm.</p>
<h2 id="gradient-descent-optimization">Gradient Descent optimization</h2>
<p>Model prediction is calculated through the forward propagation of the input data sample(s).
If weights and biases are trained well, then our predictions will be accurate as well. In order to say whether our model performs well,
we check <code>loss</code> value on every training cycle as well as <code>accuracy</code> metric. Accuracy is number of <code>correct predictions</code> divided by <code>total number</code> of data samples during the training or validation.</p>
<p>You might ask yourself - how can I train model parameters well? In other words how to update them in right direction, so that they give accurate predictions?</p>
<p>Here we meet <em>Gradient Descent.</em></p>
<p>As <a href="https://en.wikipedia.org/wiki/Gradient_descent">per Wikipedia</a>:</p>
<blockquote>
  Gradient descent is a first-order iterative optimization algorithm for finding a local minimum of a differentiable function<br />
  
</blockquote>
<p>Gradient descent is a way to minimise an objective loss function for neural network parameters. In other words, it helps to find best parameters by
minimising loss function. <em>Smaller loss, better overall network accuracy.</em></p>
<p>Using Gradient Descent, we are finding proper change rate on every training cycle.
So that we can update our weights and biases to get the best model performance.</p>
<p>How exactly the Gradient Descent algorithm calculates that change?</p>
<p>There are thousands of articles explaining that visually. In short, we are trying to find steepest descent of the derivative function.
Using small coefficient <code>learningRate</code> we subtract the gradient value from the initial parameter. That allows us to find best parameter and
minimise the loss function. One of the good visual explanation for linear regression problem with gradient descent is <a href="https://www.mygreatlearning.com/blog/gradient-descent/">here</a>. It also works well for multiple linear regression like in our case, we got 12 features, so 12 independent variables.</p>
<p>Coming back to our back-propagation implementation. <code>f'(x)</code>is a derivative function of the layer's activation function. We use derivative function to update all weights except the last one, i.e. <code>w1</code> and <code>w2</code>, not <code>w3</code>. To update <code>w3</code>, we use delta based on the <code>error</code>, i.e. predicted - actual.
Layers <code>w1</code> and <code>w2</code> are using <code>relu</code> as activation function. Derivative of the <code>relu</code> function is following:</p>
<pre data-lang="scala" style="background-color:#2e3440;color:#d8dee9;" class="language-scala "><code class="language-scala" data-lang="scala"><span style="color:#81a1c1;">if </span><span>(x &lt; </span><span style="color:#b48ead;">0</span><span>) </span><span style="color:#b48ead;">0 
</span><span style="color:#81a1c1;">else </span><span style="color:#b48ead;">1
</span></code></pre>
<p>Such derivative function is applied element-wise to <code>z</code> matrix in the step #6 of the back propagation part (see second article for Scala reference implementation).</p>
<h2 id="math-of-the-backward-propagation">Math of the Backward propagation</h2>
<p>Back-propagation part of ANN is a bit more complicated than forward propagation part.
In <em>Gradient Descent Optimization</em> algorithm, we calculate derivatives to calculate <code>yHat</code> rate of change with respect to last <code>z</code>, in our case it is <code>z3</code>.</p>
<h3 id="high-level-steps-of-the-gradient-descent-algorithm">High-level steps of the Gradient Descent algorithm</h3>
<ol start="0">
<li>Calculate error based on actual <code>y</code> and on predicted <code>yHat</code>. It will be called <code>delta</code> further and in the code.</li>
</ol>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">delta</span><span> = (yHat - y) </span><span style="color:#88c0d0;">multiply</span><span> f</span><span style="color:#a3be8c;">&#39;(z)
</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">result is a 16 x 1 matrix
</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">where:
</span><span style="color:#a3be8c;">    - &quot;f`&quot; is a derivative to activation function on the current layer.   
</span><span style="color:#a3be8c;">    - &quot;z&quot; is current layer activation.
</span><span style="color:#a3be8c;">    - &quot;multiply&quot; is Hadamard product, a.k.a. element-wise multiplication. 
</span><span style="color:#a3be8c;">      Note: it is not the same as dot product.
</span></code></pre>
<ol>
<li>Iterate list of weights matrices from end to start, i.e. backwards.
Let's take "i" as layer index</li>
<li>Calculate partial derivative as:</li>
</ol>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span> </span><span style="color:#88c0d0;">partialDerivativeN</span><span> = xi.T </span><span style="color:#81a1c1;">*</span><span> delta
</span><span>
</span><span> </span><span style="color:#88c0d0;">where:     
</span><span>     </span><span style="color:#88c0d0;">- </span><span style="color:#a3be8c;">&quot;T&quot;</span><span> is a matrix transpose operation,
</span><span>     </span><span style="color:#88c0d0;">- </span><span style="color:#a3be8c;">&quot;*&quot;</span><span> is dot product operation.    
</span></code></pre>
<ol start="3">
<li>Update weights of <code>i</code> layer via:</li>
</ol>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">wi</span><span> = wi - learningRate </span><span style="color:#81a1c1;">*</span><span> partialDerivative_i 
</span><span>
</span><span style="color:#88c0d0;">where:
</span><span>  </span><span style="color:#88c0d0;">- </span><span style="color:#a3be8c;">&quot;learningRate&quot;</span><span> is a scalar number. 
</span><span>  </span><span style="color:#88c0d0;">- </span><span style="color:#a3be8c;">&quot;partialDerivative_i&quot;</span><span> is a matrix, so </span><span style="color:#a3be8c;">&quot;*&quot;</span><span> is dot product here as well.
</span></code></pre>
<ol start="4">
<li>Update bias of <code>i</code> layer via:</li>
</ol>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">bi</span><span> = bi - sum(delta)
</span></code></pre>
<ol start="5">
<li>
<p>Pass updated weight <code>wi</code> and <code>delta</code> to previous layer, i.e. to <code>wi - 1</code>.</p>
</li>
<li>
<p>Now starting <code>wi - 1</code> weight update, we calculate <code>delta</code> differently.</p>
</li>
</ol>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">delta</span><span> = (previousDelta </span><span style="color:#81a1c1;">*</span><span> previousW) </span><span style="color:#88c0d0;">multiply</span><span> f</span><span style="color:#a3be8c;">&#39;(z)
</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">where:
</span><span style="color:#a3be8c;">   - &quot;previousDelta&quot; is delta from previous step, i.e. 
</span><span style="color:#a3be8c;">      it is from layer next to the right, because we go backward. 
</span><span style="color:#a3be8c;">   - &quot;previousW&quot; - is a weight matrix from the previous step as well.
</span></code></pre>
<p><em>If i &gt; 0, then:</em></p>
<p>decrement <code>i</code> via <code>i</code> = <code>i</code> -1 and then repeat steps from 2 to 5.</p>
<p><em>otherwise:</em></p>
<p>we finished back-propagation for a specific batch or a single data sample (in case of stochastic gradient descent).</p>
<h3 id="back-propagation-tracing">Back-propagation tracing</h3>
<h4 id="w3-between-2nd-hidden-and-output-layers-1">w3 - between 2nd hidden and output layers</h4>
<p>Delta (error):</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 16, Tensor1D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[-0.5,0.5,-2.336502E-5,0.5,0.99982685,0.0,1.0,-0.27220798,0.9981591,0.99999166,0.5142617,0.5,0.5,0.5,0.5,0.9999994]
</span></code></pre>
<p>x transpose:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6x16, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[0.0,0.0,2.3540525,0.0,1.1964836,4.380693,6.6140265,0.44490784,1.8534858,2.7576103,0.007678177,0.0,0.0,0.0,0.0,3.0259452]
</span><span> </span><span style="color:#88c0d0;">[0.0,0.0,1.4293345,0.0,1.9171724,5.341193,5.351874,0.52522117,1.888961,3.053475,0.0014958136,0.0,0.0,0.0,0.0,4.647504]
</span><span> </span><span style="color:#88c0d0;">[0.0,0.0,2.901132,0.0,3.4634292,6.8469305,9.681695,0.16261059,1.7458743,4.406227,0.0116603775,0.0,0.0,0.0,0.0,3.5064058]
</span><span> </span><span style="color:#88c0d0;">[0.0,0.0,2.2631726,0.0,1.4329143,5.5888605,7.362318,0.16618003,1.1314285,2.040889,0.023946803,0.0,0.0,0.0,0.0,2.7598464]
</span><span> </span><span style="color:#88c0d0;">[0.0,0.0,3.2273922,0.0,2.8001034,8.964131,10.323663,0.10813884,1.4567397,2.918638,0.013493502,0.0,0.0,0.0,0.0,3.6922505]
</span><span> </span><span style="color:#88c0d0;">[0.0,0.0,3.2367752,0.0,2.513441,9.055562,10.566048,0.26056617,1.7771944,3.133051,0.015981253,0.0,0.0,0.0,0.0,4.64655]]
</span></code></pre>
<p>partialDerivative3 = x.T * (delta multiply f`(z)):</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6x1, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[15.326693]
</span><span> </span><span style="color:#88c0d0;">[16.712915]
</span><span> </span><span style="color:#88c0d0;">[22.761444]
</span><span> </span><span style="color:#88c0d0;">[14.692074]
</span><span> </span><span style="color:#88c0d0;">[21.16563]
</span><span> </span><span style="color:#88c0d0;">[22.569763]]
</span></code></pre>
<p>updated Weight = w - learningRate * partialDerivative3 :</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 6x1, Tensor2D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[[0.6776238]
</span><span> </span><span style="color:#88c0d0;">[0.29685247]
</span><span> </span><span style="color:#88c0d0;">[0.496793]
</span><span> </span><span style="color:#88c0d0;">[0.95105153]
</span><span> </span><span style="color:#88c0d0;">[0.824897]
</span><span> </span><span style="color:#88c0d0;">[0.64518374]]
</span></code></pre>
<p>updated Bias = b - learningRate * sum(delta) :</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">sizes:</span><span> 1, Tensor1D</span><span style="color:#81a1c1;">[</span><span>Float</span><span style="color:#81a1c1;">]</span><span>:
</span><span style="color:#88c0d0;">[-0.0077400077]
</span></code></pre>
<h4 id="w2-between-1st-and-2nd-hidden-layers-1">w2 - between 1st and 2nd hidden layers</h4>
<p>current delta:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">delta</span><span> (16x6) </span><span style="color:#81a1c1;">= </span><span>(</span><span style="color:#88c0d0;">previous</span><span> delta </span><span style="color:#81a1c1;">*</span><span> previous w) multiply f`(</span><span style="color:#88c0d0;">z</span><span>)
</span></code></pre>
<p>current derivative:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">partialDerivative2</span><span> (6 x 6) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">x.T</span><span> (6 x 16) </span><span style="color:#88c0d0;">*</span><span> delta (16 x 6)
</span></code></pre>
<p>updated Weight:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">w2</span><span> (6x6) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">w2</span><span> (6x6) </span><span style="color:#88c0d0;">-</span><span> learningRate </span><span style="color:#81a1c1;">*</span><span> partialDerivative2 (6 x 6)
</span></code></pre>
<p>updated Bias:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">b2</span><span> (6 x 1) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">b2</span><span> (6 x 1) </span><span style="color:#88c0d0;">-</span><span> learningRate </span><span style="color:#81a1c1;">*</span><span> sum(delta)
</span></code></pre>
<h4 id="w1-between-input-and-1st-hidden-layers-1">w1 - between input and 1st hidden layers</h4>
<p>current delta:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">delta</span><span> (16x6) </span><span style="color:#81a1c1;">= </span><span>(</span><span style="color:#88c0d0;">previous</span><span> delta </span><span style="color:#81a1c1;">*</span><span> previous w) multiply f`(</span><span style="color:#88c0d0;">z</span><span>)
</span></code></pre>
<p>current derivative:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">partialDerivative1</span><span> (12 x 6) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">x.T</span><span> (12 x 16) </span><span style="color:#88c0d0;">*</span><span> delta (16 x 6)
</span></code></pre>
<p>updated Weight:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">w1</span><span> (12x6) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">w2</span><span> (12x6) </span><span style="color:#88c0d0;">-</span><span> learningRate </span><span style="color:#81a1c1;">*</span><span> partialDerivative1 (12 x 6)
</span></code></pre>
<p>updated Bias:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#88c0d0;">b1</span><span> (6 x 1) </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">b1</span><span> (6 x 1) </span><span style="color:#88c0d0;">-</span><span> learningRate </span><span style="color:#81a1c1;">*</span><span> sum(delta)
</span></code></pre>
<h1 id="wrapping-up">Wrapping up</h1>
<p>We have finished with theoretical part and ready to continue with the second article <a href="../ann-in-scala-2">ANN in Scala: implementation</a>.
In case you have not gotten how the ANN is actually working in theory, then I encourage you to search for other articles and
videos. It is important to understand this part before looking at actual implementation in code.</p>

          </div>
          <div class="container has-text-centered">
            
  <p class="is-size-5">
    Share:
    <a class="link" data-sharer="facebook" data-url='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;ann-in-scala-1&#x2F;' href="javascript:void(0);" title="Share on facebook">
      <span class="icon">
        <i class="fab fa-facebook-square"></i>
      </span>
    </a>
    <a class="link" data-sharer="twitter" data-title='Artificial Neural Network in Scala - part 1' data-url='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;ann-in-scala-1&#x2F;' href="javascript:void(0);" title="Share on twitter">
      <span class="icon">
        <i class="fab fa-twitter"></i>
      </span>
    </a>
    <a class="link" data-sharer="linkedin" data-url='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;ann-in-scala-1&#x2F;' href="javascript:void(0);" title="Share on linkedin">
      <span class="icon">
        <i class="fab fa-linkedin"></i>
      </span>
    </a>
    <a class="link" data-sharer="reddit" data-url='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;ann-in-scala-1&#x2F;' href="javascript:void(0);" title="Share on reddit">
      <span class="icon">
        <i class="fab fa-reddit"></i>
      </span>
    </a>
    <a class="link" data-sharer="hackernews" data-title="Artificial Neural Network in Scala - part 1" data-url='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;ann-in-scala-1&#x2F;' href="javascript:void(0);" title="Share on hackernews">
      <span class="icon">
        <i class="fab fa-hacker-news"></i>
      </span>
    </a>
    <a class="link" data-sharer="whatsapp" data-title="Artificial Neural Network in Scala - part 1" data-url='https:&#x2F;&#x2F;novakov-alexey.github.io&#x2F;ann-in-scala-1&#x2F;' href="javascript:void(0);" title="Share on whatsapp">
      <span class="icon">
        <i class="fab fa-whatsapp-square"></i>
      </span>
    </a>
  </p>

          </div>
        </article>
      </div>
      
      <div class="column is-2 is-hidden-mobile">
        <aside class="menu" style="position: sticky; top: 48px">
          <p class="heading has-text-weight-bold">Contents</p>
          <ul class="menu-list">
            
            <li>
              <a id="link-scope" class="toc is-size-7 is-active" href="https://novakov-alexey.github.io/ann-in-scala-1/#scope">
                Scope
              </a>
              
            </li>
            
            <li>
              <a id="link-ann-jargon" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#ann-jargon">
                ANN Jargon
              </a>
              
            </li>
            
            <li>
              <a id="link-tensor" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#tensor">
                Tensor
              </a>
              
            </li>
            
            <li>
              <a id="link-dataset" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#dataset">
                Dataset
              </a>
              
            </li>
            
            <li>
              <a id="link-network-topology" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#network-topology">
                Network Topology
              </a>
              
            </li>
            
            <li>
              <a id="link-forward-propagation" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#forward-propagation">
                Forward Propagation
              </a>
              
              <ul>
                
                <li>
                  <a id="link-dimensions" class="toc is-size-7" href="https://novakov-alexey.github.io/ann-in-scala-1/#dimensions">
                    Dimensions
                  </a>
                </li>
                
                <li>
                  <a id="link-math-of-the-forward-propagation" class="toc is-size-7" href="https://novakov-alexey.github.io/ann-in-scala-1/#math-of-the-forward-propagation">
                    Math of the Forward propagation
                  </a>
                </li>
                
                <li>
                  <a id="link-batch-tracing" class="toc is-size-7" href="https://novakov-alexey.github.io/ann-in-scala-1/#batch-tracing">
                    Batch Tracing
                  </a>
                </li>
                
              </ul>
              
            </li>
            
            <li>
              <a id="link-backward-propagation" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#backward-propagation">
                Backward Propagation
              </a>
              
              <ul>
                
                <li>
                  <a id="link-gradient-descent-optimization" class="toc is-size-7" href="https://novakov-alexey.github.io/ann-in-scala-1/#gradient-descent-optimization">
                    Gradient Descent optimization
                  </a>
                </li>
                
                <li>
                  <a id="link-math-of-the-backward-propagation" class="toc is-size-7" href="https://novakov-alexey.github.io/ann-in-scala-1/#math-of-the-backward-propagation">
                    Math of the Backward propagation
                  </a>
                </li>
                
              </ul>
              
            </li>
            
            <li>
              <a id="link-wrapping-up" class="toc is-size-7 " href="https://novakov-alexey.github.io/ann-in-scala-1/#wrapping-up">
                Wrapping up
              </a>
              
            </li>
            
          </ul>
        </aside>
      </div>
      
    </div>
  </div>
</section>
  


  
  <section class="modal" id="search-modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="field">
        <p class="control has-icons-right">
          <input class="input" id="search" placeholder="Search this website." type="search" />
          <span class="icon is-small is-right">
            <i class="fas fa-search"></i>
          </span>
        </p>
      </div>
      <div class="search-results">
        <div class="search-results__items"></div>
      </div>
    </div>
    <button aria-label="close" class="modal-close is-large"></button>
  </section>
  


  



  
<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-6">
        <div id="disqus_thread"></div>
      </div>
    </div>
  </div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    
    var disqus_config = function () {      
      this.page.url = 'https://novakov-alexey.github.io/ann-in-scala-1/';  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = 'ann-in-scala-1'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://novakov-alexey-blog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


  
  <footer class="py-4 has-background-light">
    <p class="has-text-centered">
      Built with
      <span class="icon is-small">
        <i class="fas fa-code fa-xs"></i>
      </span>
      code and
      <span class="icon is-small">
        <i class="fas fa-heart fa-xs"></i>
      </span>
      love <br /> Powered By
      <span class="icon is-small">
        <i class="fas fa-power-off fa-xs"></i>
      </span>
      Zola
    </p>
  </footer>
  

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/galleria.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1/dist/chart.xkcd.min.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.6.1/themes/folio/galleria.folio.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
  <script src='https://novakov-alexey.github.io/search_index.en.js'></script>
  <script src='https://novakov-alexey.github.io/js/site.js'></script>

  

<script type="text/javascript">
  const menuBarHeight = $("nav.navbar").height();
  const tocItems = $('.toc');
  const navSections = new Array($('.toc').length);

  tocItems.each(function (i) {
    let id = $(this).attr("id").substring(5);
    navSections[i] = document.getElementById(id);
  })

  function isVisible(tocIndex) {
    const current = navSections[tocIndex];
    const next = tocIndex < tocItems.length - 1 ? navSections[tocIndex+1] : $("section.section").get(1);
    
    const c = current.getBoundingClientRect();
    const n = next.getBoundingClientRect();
    const h = (window.innerHeight || document.documentElement.clientHeight);

    return (c.top <= h) && (c.top + (n.top - c.top) - menuBarHeight >= 0);
  }

  function activateIfVisible() {
    for (b = true, i = 0; i < tocItems.length; i++) {
      if (b && isVisible(i)) {
        tocItems[i].classList.add('is-active');
        b = false;
      } else
        tocItems[i].classList.remove('is-active');
    }
  }

  var isTicking = null;
  window.addEventListener('scroll', () => {
    if (!isTicking) {
      window.requestAnimationFrame(() => {
        activateIfVisible();
        isTicking = false;
      });
      isTicking = true;
    }
  }, false);
</script>




</body>

</html>